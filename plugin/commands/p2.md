---
name: p2
description: |
  Spawns a trigger agent that drives THIS session through a beads epic: task → develop →
  /linus → /triage (if findings) → compact (if context >50%) → repeat. Final /linus + /triage
  when done. Your main session does all the work. The trigger just sends commands and waits.
---

# Epic Run

You are about to hand control of this session to a trigger agent. Your job right now:

1. Detect this session's tmux target
2. Determine the epic ID
3. Spawn the trigger
4. Send it a short skill invocation
5. Get out of the way

## Step 1: Detect your own tmux target

```bash
tmux display-message -p '#{session_name}:#{window_index}.#{pane_index}'
```

Save as `MAIN_TARGET`.

## Step 2: Determine epic ID

If `$ARGUMENTS` contains an epic ID, use it as `EPIC_ID`.

Otherwise, find it:
```bash
bd list --type=epic --status=open
```
If multiple epics, ask the user which one. If one, use it.

Verify:
```bash
bd ready --parent <EPIC_ID>
```
If no ready tasks, tell the user and stop.

## Step 3: Get project cwd

```bash
pwd
```

Save as `PROJECT_CWD`.

## Step 4: Spawn trigger session

```bash
claude-mux new-session --cwd <PROJECT_CWD> --name trigger-epic --linked-to <MAIN_TARGET>
```

Save `tmuxTarget` as `TRIGGER_TARGET`.
Wait for ready:
```bash
claude-mux wait <TRIGGER_TARGET> --timeout 60 --state idle
```

## Step 5: Send trigger its skill invocation

Send this short command to the trigger (replace variables with actual values):
```bash
claude-mux send <TRIGGER_TARGET> "/p2-trigger <MAIN_TARGET> <EPIC_ID> <PROJECT_CWD>"
```

Then send a separate Enter key to make sure it starts:
```bash
claude-mux send <TRIGGER_TARGET> --keys Enter
```

## Step 6: Report and exit

Tell the user:
"Trigger agent spawned at `<TRIGGER_TARGET>`. It will drive this session through epic `<EPIC_ID>`. Tasks will be sent here one at a time, with /linus reviews and /compact between each. Sit back and watch."

Then STOP. Do not do anything else. Your turn is over. The trigger takes it from here.
