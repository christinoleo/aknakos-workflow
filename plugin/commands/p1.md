---
name: p1
description: |
  Spawns a trigger agent that drives THIS session through: plan → approve → /replan →
  /plan-to-beads → verify beads → sync. Your main session does all the work (it has the
  context). The trigger just sends commands and waits. Phase 1 of orchestration.
---

# Finalize Plan

You are about to hand control of this session to a trigger agent. Your job right now:

1. Detect this session's tmux target
2. Spawn the trigger
3. Send it a short skill invocation
4. Get out of the way

## Step 1: Detect your own tmux target

```bash
tmux display-message -p '#{session_name}:#{window_index}.#{pane_index}'
```

Save this as `MAIN_TARGET`.

## Step 2: Get project cwd

```bash
pwd
```

Save as `PROJECT_CWD`.

## Step 3: Spawn trigger session

```bash
claude-mux new-session --cwd <PROJECT_CWD> --name trigger-finalize --linked-to <MAIN_TARGET>
```

Save the `tmuxTarget` from the JSON output as `TRIGGER_TARGET`.
Wait for it to be ready:
```bash
claude-mux wait <TRIGGER_TARGET> --timeout 60 --state idle
```

## Step 4: Send trigger its skill invocation

Send this short command to the trigger (replace variables with actual values):
```bash
claude-mux send <TRIGGER_TARGET> "/p1-trigger <MAIN_TARGET> <PROJECT_CWD>"
```

Then send a separate Enter key to make sure it starts:
```bash
claude-mux send <TRIGGER_TARGET> --keys Enter
```

## Step 5: Report and exit

Tell the user:
"Trigger agent spawned at `<TRIGGER_TARGET>`. It will drive this session through planning → replan → beads conversion. Sit back and watch — the trigger will send commands here."

Then STOP. Do not do anything else. Your turn is over. The trigger takes it from here.
